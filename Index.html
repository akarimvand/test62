<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فرم نمایش داده‌ها</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <!-- Font Vazir -->
    <link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazir', sans-serif;
        }
        .form-container {
            margin: 20px;
        }
        .data-grid {
            margin-top: 20px;
        }
        /* Style for rows with Final_Result = "acc" */
        .acc-row {
            background-color: #d4edda !important; /* Light green */
            color: #155724 !important; /* Dark green text */
        }
    </style>
</head>
<body>

<div class="container form-container">
    <h1 class="text-center mb-4">نمایش اطلاعات جوشکاران</h1>

    <!-- Combobox -->
    <div class="row mb-4">
        <div class="col-md-6 offset-md-3">
            <label for="persianNameSelect" class="form-label">انتخاب نام فارسی و Welder Stamp:</label>
            <select id="persianNameSelect" class="form-select">
                <option value="">-- انتخاب کنید --</option>
            </select>
        </div>
    </div>

    <!-- Display Fields -->
    <div class="row mb-4">
        <div class="col-md-4">
            <label for="welderStamp" class="form-label">Welder Stamp:</label>
            <input type="text" id="welderStamp" class="form-control" readonly>
        </div>
        <div class="col-md-4">
            <label for="nationalCode" class="form-label">National Code:</label>
            <input type="text" id="nationalCode" class="form-control" readonly>
        </div>
        <div class="col-md-4">
            <label for="persianName" class="form-label">Persian Name:</label>
            <input type="text" id="persianName" class="form-control" readonly>
        </div>
    </div>

    <!-- DataGrid -->
    <div class="data-grid">
        <table id="dataTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Welding Process</th>
                    <th>Material</th>
                    <th>Thk</th>
                    <th>WQT Rep</th>
                    <th>WQT Date</th>
                    <th>NDT REP No</th>
                    <th>NDT REP Date</th>
                    <th>NDT Result</th>
                    <th>Final Result</th>
                    <th>Welder Stamp</th> <!-- Added Welder Stamp -->
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated here -->
            </tbody>
        </table>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script>
    $(document).ready(function () {
        // Fetch and process data from the text file
        const url = "https://raw.githubusercontent.com/akarimvand/test62/refs/heads/main/db.txt";

        $.get(url, function (data) {
            const lines = data.split("\n");
            const headers = lines[0].split("\t");
            const records = [];

            // Parse data into objects
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split("\t");
                if (values.length === headers.length) {
                    const record = {};
                    headers.forEach((header, index) => {
                        record[header.trim()] = values[index].trim();
                    });
                    records.push(record);
                }
            }

            // Extract unique combinations of Persian_Name and Welder_Stamp
            const uniqueCombinations = [...new Set(records.map(record => 
                `${record.Persian_Name} (${record.Welder_Stamp})`
            ))];

            // Populate Combobox
            const persianNameSelect = $("#persianNameSelect");
            uniqueCombinations.forEach(combination => {
                persianNameSelect.append(`<option value="${combination}">${combination}</option>`);
            });

            // Handle Combobox selection
            persianNameSelect.on("change", function () {
                const selectedCombination = $(this).val();
                if (selectedCombination) {
                    const [selectedName, selectedStamp] = selectedCombination.match(/(.*) \((.*)\)/).slice(1);
                    const selectedRecord = records.find(record => 
                        record.Persian_Name === selectedName && record.Welder_Stamp === selectedStamp
                    );

                    // Populate fields
                    $("#welderStamp").val(selectedRecord.Welder_Stamp);
                    $("#nationalCode").val(selectedRecord.National_Code);
                    $("#persianName").val(selectedRecord.Persian_Name);

                    // Populate DataGrid based on Welder_Stamp
                    const dataTableBody = $("#dataTable tbody");
                    dataTableBody.empty();

                    const filteredRecords = records.filter(record => 
                        record.Persian_Name === selectedName && record.Welder_Stamp === selectedStamp
                    );

                    filteredRecords.forEach(record => {
                        const rowClass = record.Final_Result === "acc" ? "acc-row" : "";
                        const row = `
                            <tr class="${rowClass}">
                                <td>${record.Position || ""}</td>
                                <td>${record.Welding_Process || ""}</td>
                                <td>${record.Material || ""}</td>
                                <td>${record.Thk || ""}</td>
                                <td>${record.WQT_Rep || ""}</td>
                                <td>${record.WQT_Date || ""}</td>
                                <td>${record.NDT_REP_No || ""}</td>
                                <td>${record.NDT_REP_DATE || ""}</td>
                                <td>${record.NDT_RESULT || ""}</td>
                                <td>${record.Final_Result || ""}</td>
                                <td>${record.Welder_Stamp || ""}</td> <!-- Added Welder Stamp -->
                            </tr>
                        `;
                        dataTableBody.append(row);
                    });

                    // Initialize DataTable
                    $('#dataTable').DataTable().destroy();
                    $('#dataTable').DataTable({
                        language: {
                            url: "//cdn.datatables.net/plug-ins/1.13.4/i18n/fa.json"
                        },
                        createdRow: function (row, data, dataIndex) {
                            // Apply custom class to rows with Final_Result = "acc"
                            if (data[9] === "acc") { // Column index for Final_Result is 9
                                $(row).addClass('acc-row');
                            }
                        }
                    });
                } else {
                    // Clear fields and DataGrid
                    $("#welderStamp").val("");
                    $("#nationalCode").val("");
                    $("#persianName").val("");
                    $("#dataTable tbody").empty();
                }
            });
        }).fail(function () {
            alert("خطا در بارگذاری داده‌ها!");
        });
    });
</script>

</body>
</html>
